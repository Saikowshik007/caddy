jobtrackai.duckdns.org {
    # Automatic HTTPS with Let's Encrypt

    # JobTrak API endpoints (microservice 2)
    handle /api/* {
        # CORS headers for API
        header {
            Access-Control-Allow-Origin "https://job-agent-ui.vercel.app https://streaming-service.vercel.app https://jobtrackai.duckdns.org http://localhost:3000"
            Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH, HEAD"
            Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, X-Api-Key, x-api-key, Range, Accept"
            Access-Control-Allow-Credentials "true"
            Access-Control-Expose-Headers "Content-Length, Content-Range, X-Total-Count"
            Access-Control-Max-Age "3600"
        }

        # Load balance across 3 API instances
        reverse_proxy {
            to jobtrak-api-1:8000 jobtrak-api-2:8000 jobtrak-api-3:8000
            lb_policy round_robin

            # Health checks
            health_uri /health
            health_interval 30s
            health_timeout 10s
            health_status 2xx
        }
    }

    # Learning Platform endpoints (microservice 1)
    handle /learn/* {
        # CORS headers for learning platform
        header {
            Access-Control-Allow-Origin "https://streaming-service.vercel.app https://jobtrackai.duckdns.org http://localhost:3000"
            Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH, HEAD"
            Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Range, Accept"
            Access-Control-Allow-Credentials "true"
            Access-Control-Expose-Headers "Content-Length, Content-Range, Accept-Ranges"
            Access-Control-Max-Age "3600"
        }

        # Reverse proxy to learning backend
        reverse_proxy learning-platform-backend:5000
    }

    # Root endpoint
    handle / {
        respond "JobTrak Services Running" 200
    }

    # Health check aggregation endpoint
    handle /health {
        reverse_proxy jobtrak-api-1:8000
    }
}